# Інструкція з запуску та демонстрації SignalR

## Крок 1: Підготовка

1. Переконайтеся, що база даних SQLite існує та містить тестові дані
2. Переконайтеся, що у вас є хоча б один зареєстрований користувач

## Крок 2: Запуск проекту

### Варіант 1: Через Visual Studio
1. Встановіть **HospitalSystem** як StartUp Project (НЕ API, НЕ Blazor)
2. Натисніть F5 або кнопку "Start"

### Варіант 2: Через командний рядок
```bash
cd HospitalSystem
dotnet run
```

## Крок 3: Демонстрація функціональності

### Тест 1: Базова перевірка підключення
1. Відкрийте браузер
2. Перейдіть на http://localhost:5000 (або інший порт з консолі)
3. Авторизуйтесь
4. Відкрийте Developer Tools (F12)
5. Перейдіть на вкладку Console
6. Ви повинні побачити повідомлення: **"SignalR Connected"**

### Тест 2: Real-Time Dashboard
1. Після авторизації перейдіть на `/Appointments/Dashboard`
2. Переконайтеся, що індикатор показує "Connected" (зелений badge)
3. Відкрийте нову вкладку в тому ж браузері
4. В новій вкладці перейдіть на `/Appointments/Create`
5. Заповніть форму та створіть новий запис
6. Поверніться на вкладку з Dashboard
7. **Очікуваний результат:**
   - З'явиться toast-повідомлення "Новий запис створено..."
   - Лічильник "Створено" збільшиться на 1
   - В списку "Останні події" з'явиться новий запис
   - Через 2 секунди сторінка автоматично оновиться

### Тест 3: Множинні користувачі
1. Відкрийте два різні браузери (наприклад, Chrome і Firefox)
   АБО відкрийте звичайне вікно та Incognito/Private вікно
2. Авторизуйтесь в обох браузерах
3. В **Браузері 1**: відкрийте `/Appointments/Dashboard`
4. В **Браузері 2**: відкрийте `/Appointments/Create`
5. В Браузері 2 створіть новий запис
6. **Очікуваний результат в Браузері 1:**
   - Миттєво з'явиться toast-повідомлення
   - Оновиться статистика на Dashboard
   - Додасться запис в список подій

### Тест 4: Оновлення запису
1. В одному браузері відкрийте `/Appointments`
2. В іншому браузері відкрийте `/Appointments/Dashboard`
3. В першому браузері натисніть "Edit" (іконка олівця) на будь-якому записі
4. Змініть дані (наприклад, дату або ім'я пацієнта)
5. Збережіть зміни
6. **Очікуваний результат в Dashboard:**
   - З'явиться помаранчеве toast-повідомлення "Запис оновлено..."
   - Лічильник "Оновлено" збільшиться
   - Через 2 секунди сторінка оновиться з новими даними

### Тест 5: Видалення запису (скасування візиту)
1. Відкрийте `/Appointments/Dashboard`
2. В іншій вкладці перейдіть на `/Appointments`
3. Натисніть "Delete" (іконка сміттєвого бака) на будь-якому записі
4. Підтвердіть видалення
5. **Очікуваний результат в Dashboard:**
   - З'явиться червоне toast-повідомлення "Запис скасовано: [Лікар] на [Дата/Час] тепер вільний"
   - Лічильник "Видалено" збільшиться
   - Через 2 секунди сторінка оновиться

### Тест 6: Перепідключення
1. Відкрийте `/Appointments/Dashboard`
2. Відкрийте Developer Tools (F12) → Network tab
3. Встановіть "Slow 3G" або "Offline" в Network throttling
4. Індикатор з'єднання має змінитися на "Reconnecting..." (жовтий badge)
5. Поверніть нормальне з'єднання
6. Індикатор має повернутися до "Connected" (зелений badge)

## Крок 4: Перевірка в різних сценаріях

### Сценарій А: Лікар скасовує прийом
```
Користувач 1 (Пацієнт): Переглядає /Appointments
Користувач 2 (Лікар): Видаляє запис
Результат: Пацієнт миттєво бачить, що час звільнився
```

### Сценарій Б: Адміністратор створює запис
```
Користувач 1: Dashboard
Користувач 2 (Адмін): Створює новий запис для пацієнта
Результат: На Dashboard миттєво з'являється інформація про новий запис
```

### Сценарій В: Перенесення прийому
```
Користувач 1: Переглядає список записів
Користувач 2: Редагує запис (змінює час)
Результат: Користувач 1 бачить повідомлення про зміну і оновлені дані
```

## Крок 5: Перевірка в Console

Відкрийте Console (F12) і подивіться логи:
```
SignalR Connected
Appointment Created: {appointmentId: 123, patientName: "...", ...}
Appointment Updated: {appointmentId: 124, ...}
Appointment Deleted: {appointmentId: 125, ...}
```

## Очікувані помилки та їх вирішення

### Помилка: "SignalR Connection Error"
**Причина:** SignalR Hub не запущений
**Рішення:** Переконайтеся, що в Program.cs є:
- `builder.Services.AddSignalR()`
- `app.MapHub<AppointmentHub>("/appointmentHub")`

### Помилка: Toast-повідомлення не з'являються
**Причина:** JavaScript файл не підключено
**Рішення:** Перевірте, що в _Layout.cshtml є:
- Підключення SignalR CDN
- Підключення ~/js/appointment-signalr.js

### Помилка: "404 Not Found" для /appointmentHub
**Причина:** Маршрут не зареєстровано
**Рішення:** Додайте `app.MapHub<AppointmentHub>("/appointmentHub")` в Program.cs

### Помилка: Сторінка не оновлюється автоматично
**Причина:** JavaScript блокується або є помилки в коді
**Рішення:** Відкрийте Console (F12) та перевірте наявність помилок JavaScript

## Демонстраційний чеклист

✅ SignalR підключається успішно (Console: "SignalR Connected")
✅ Dashboard показує статус "Connected"
✅ Створення запису генерує toast-повідомлення
✅ Оновлення запису генерує toast-повідомлення
✅ Видалення запису генерує toast-повідомлення
✅ Статистика на Dashboard оновлюється
✅ Події додаються в список "Останні події"
✅ Автоматичне оновлення сторінки через 2 секунди
✅ Множинні користувачі бачать зміни одночасно
✅ Автоматичне перепідключення працює

## Корисні URL

- **Головна:** http://localhost:5000/
- **Список записів:** http://localhost:5000/Appointments
- **Створити запис:** http://localhost:5000/Appointments/Create
- **Dashboard:** http://localhost:5000/Appointments/Dashboard
- **Список лікарів:** http://localhost:5000/Doctors

## Відео-демонстрація (рекомендовано)

Для демонстрації викладачу рекомендується:
1. Записати екран з двома вікнами браузера side-by-side
2. В одному вікні - Dashboard
3. В другому - створення/редагування/видалення записів
4. Показати real-time оновлення в першому вікні
5. Показати Console з логами SignalR

## Підсумок

SignalR успішно інтегровано в проект HospitalSystem і реалізує:
- ✅ Оновлення доступних годин візиту в реальному часі
- ✅ Сповіщення про створення нових записів
- ✅ Сповіщення про зміну часу прийому
- ✅ Сповіщення про скасування записів (звільнення часу)
- ✅ Broadcast повідомлень всім підключеним користувачам
- ✅ Real-time Dashboard для моніторингу

Всі користувачі системи миттєво бачать зміни в розкладі, що дозволяє:
- Пацієнтам швидко дізнатися про вільні години
- Лікарям бачити актуальний розклад
- Адміністраторам моніторити активність в реальному часі
