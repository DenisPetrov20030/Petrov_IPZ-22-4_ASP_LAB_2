@page "/appointments/details/{id:long}"
@attribute [Authorize]
@inject AppointmentService AppointmentService
@inject NavigationManager NavigationManager

<PageTitle>Деталі запису - Hospital System</PageTitle>

<div class="container py-4">
	@if (isLoading)
	{
		<div class="text-center py-5">
			<div class="spinner-border text-primary" role="status">
				<span class="visually-hidden">Завантаження...</span>
			</div>
		</div>
	}
	else if (appointment == null)
	{
		<div class="alert alert-danger" role="alert">
			<i class="bi bi-exclamation-triangle"></i> Запис не знайдено
		</div>
	}
	else
	{
		<div class="card shadow">
			<div class="card-header bg-info text-white">
				<h4 class="mb-0"><i class="bi bi-info-circle"></i> Деталі запису</h4>
			</div>
			<div class="card-body">
				<dl class="row">
					<dt class="col-sm-4">ID запису:</dt>
					<dd class="col-sm-8">@appointment.AppointmentID</dd>

					<dt class="col-sm-4">Пацієнт:</dt>
					<dd class="col-sm-8">@appointment.PatientName</dd>

					<dt class="col-sm-4">Лікар:</dt>
					<dd class="col-sm-8">@appointment.DoctorName</dd>

					@if (appointment.Doctor != null)
					{
						<dt class="col-sm-4">Лікар (деталі):</dt>
						<dd class="col-sm-8">
							<div class="card">
								<div class="card-body">
									<h6 class="card-title">@appointment.Doctor.FullName</h6>
									<p class="card-text mb-1"><strong>Спеціалізація:</strong> @appointment.Doctor.Specialization</p>
									<p class="card-text mb-1"><strong>Відділення:</strong> @appointment.Doctor.Department</p>
									<p class="card-text mb-1"><strong>Телефон:</strong> @appointment.Doctor.PhoneNumber</p>
									<p class="card-text mb-0"><strong>Email:</strong> @appointment.Doctor.Email</p>
								</div>
							</div>
						</dd>
					}

					<dt class="col-sm-4">Дата і час:</dt>
					<dd class="col-sm-8">@appointment.AppointmentDate.ToString("dd.MM.yyyy HH:mm")</dd>

					<dt class="col-sm-4">Відділення:</dt>
					<dd class="col-sm-8"><span class="badge bg-info">@appointment.Department</span></dd>

					<dt class="col-sm-4">Примітки:</dt>
					<dd class="col-sm-8">
						@if (string.IsNullOrWhiteSpace(appointment.Notes))
						{
							<em class="text-muted">Без приміток</em>
						}
						else
						{
							@appointment.Notes
						}
					</dd>
				</dl>

				<div class="mt-4 d-flex justify-content-between">
					<div>
						<a href="/appointments/edit/@appointment.AppointmentID" class="btn btn-warning">
							<i class="bi bi-pencil"></i> Редагувати
						</a>
						<a href="/appointments/delete/@appointment.AppointmentID" class="btn btn-danger">
							<i class="bi bi-trash"></i> Видалити
						</a>
					</div>
					<a href="/appointments" class="btn btn-outline-secondary">
						<i class="bi bi-arrow-left"></i> Назад до списку
					</a>
				</div>
			</div>
		</div>
	}
</div>

@code {
	[Parameter]
	public long Id { get; set; }

	private Appointment? appointment;
	private bool isLoading = true;

	protected override async Task OnInitializedAsync()
	{
		isLoading = true;
		try
		{
			appointment = await AppointmentService.GetAppointmentByIdAsync(Id);
		}
		catch (Exception ex)
		{
			Console.WriteLine($"Error loading appointment: {ex.Message}");
		}
		finally
		{
			isLoading = false;
		}
	}
}
