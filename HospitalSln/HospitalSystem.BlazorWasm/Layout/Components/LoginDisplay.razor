@using Microsoft.AspNetCore.Components.Authorization
@inject AuthService AuthService
@inject NavigationManager NavigationManager

<AuthorizeView>
	<Authorized>
		<div class="dropdown">
			<button class="btn btn-outline-light dropdown-toggle" type="button" id="userMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
				<i class="bi bi-person-circle"></i> @context.User.Identity?.Name
			</button>
			<ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenuButton">
				<li><span class="dropdown-item-text"><strong>Роль:</strong> @GetUserRole(context)</span></li>
				<li><hr class="dropdown-divider"></li>
				<li><button class="dropdown-item" @onclick="HandleLogout">
					<i class="bi bi-box-arrow-right"></i> Вийти
				</button></li>
			</ul>
		</div>
	</Authorized>
	<NotAuthorized>
		<a href="/login" class="btn btn-outline-light me-2">
			<i class="bi bi-box-arrow-in-right"></i> Вхід
		</a>
		<a href="/register" class="btn btn-light">
			<i class="bi bi-person-plus"></i> Реєстрація
		</a>
	</NotAuthorized>
</AuthorizeView>

@code {
	private string GetUserRole(AuthenticationState authState)
	{
		var roleClaim = authState.User.Claims.FirstOrDefault(c => c.Type == System.Security.Claims.ClaimTypes.Role);
		return roleClaim?.Value ?? "Користувач";
	}

	private async Task HandleLogout()
	{
		await AuthService.LogoutAsync();
		NavigationManager.NavigateTo("/", true);
	}
}
